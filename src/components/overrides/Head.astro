---
import HeadBase from "@astrojs/starlight/components/Head.astro";
import { detectEnvironment } from "../../../config/environment.js";

// Define interfaces for better type safety
interface MetaTag {
  tag: string;
  attrs: {
    property?: string;
    name?: string;
    content?: string;
    [key: string]: string | undefined;
  };
  content?: string;
}

// Get page info from the props passed by Starlight
const { head: originalHead = [] } = Astro.props;

// Get environment information
const env = detectEnvironment();
const siteUrl =
  env && typeof env === "object" && "siteUrl" in env
    ? (env.siteUrl as string)
    : "";

const hasOgImage = originalHead.some(
  (tag: MetaTag) => tag.attrs?.property === "og:image",
);
const hasOgLogo = originalHead.some(
  (tag: MetaTag) => tag.attrs?.property === "og:logo",
);
---

<HeadBase head={originalHead} />

<!-- Add critical OG tags only if missing -->
{!hasOgImage && <meta property="og:image" content={`${siteUrl}/logo.png`} />}
{!hasOgLogo && <meta property="og:logo" content={`${siteUrl}/logo.png`} />}
