---
import HeadBase from "@astrojs/starlight/components/Head.astro";
import { detectEnvironment } from "../../../config/environment.js";

// Define interfaces for better type safety
interface MetaTag {
  tag: string;
  attrs: {
    property?: string;
    name?: string;
    content?: string;
    [key: string]: string | undefined;
  };
  content?: string;
}

// Get page info from the props passed by Starlight
const { head: originalHead = [] } = Astro.props;

// Get environment information
const env = detectEnvironment();
const { siteUrl = "" } = env as { siteUrl: string };

// Check if OG tags already exist
const hasOgTag = (property: string) => 
  originalHead.some((tag: MetaTag) => tag.attrs?.property === property);

const hasOgImage = hasOgTag("og:image");
const hasOgLogo = hasOgTag("og:logo");
---

<HeadBase head={originalHead} />

<!-- Add critical OG tags only if missing -->
{!hasOgImage && <meta property="og:image" content={`${siteUrl}/logo.png`} />}
{!hasOgLogo && <meta property="og:logo" content={`${siteUrl}/logo.png`} />}
