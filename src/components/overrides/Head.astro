---
import HeadBase from "@astrojs/starlight/components/Head.astro";
import { detectEnvironment } from "../../../config/environment.js";
import { generateMetaTags } from "../../../config/seo.js";

// Define interfaces for better type safety
interface MetaTag {
  tag: string;
  attrs: {
    property?: string;
    name?: string;
    content?: string;
    [key: string]: string | undefined;
  };
  content?: string;
}

// Get page info from the props passed by Starlight
const page = Astro.props.entry;
const { head: originalHead = [] } = Astro.props;

// Get environment information
const env = detectEnvironment();
const siteUrl =
  env && typeof env === "object" && "siteUrl" in env
    ? (env.siteUrl as string)
    : "";

// Generate page-specific URL
let pageUrl = siteUrl;
if (page?.slug && page.slug !== "index") {
  pageUrl = `${siteUrl}/${page.slug}`;
}

console.log("Current site URL:", siteUrl);
console.log("Current page data:", page?.slug, page?.data?.title);
console.log("Generated page URL:", pageUrl);

// For debugging - log the page description
console.log("Page description:", page?.data?.description);

// Simply use original head without modification - Starlight already includes correct metadata
const customHead = originalHead;

// Check if we need to add og:image and og:logo manually
const hasOgImage = customHead.some(
  (tag: MetaTag) => tag.attrs?.property === "og:image",
);
const hasOgLogo = customHead.some(
  (tag: MetaTag) => tag.attrs?.property === "og:logo",
);
---

<HeadBase head={customHead} />

<!-- Add critical OG tags only if missing -->
{!hasOgImage && <meta property="og:image" content={`${siteUrl}/logo.png`} />}
{!hasOgLogo && <meta property="og:logo" content={`${siteUrl}/logo.png`} />}
